<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">

      <h1 class="display-4 text-success mb-4">
        <i class="fas fa-utensils"></i> å¤œã”ã¯ã‚“ã®æŠ•ç¨¿
      </h1>

      <!-- âœ… éƒ¨åˆ†ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‘¼ã³å‡ºã— -->
      <%= render partial: 'public/dinners/dinner', locals: { dinner: @dinner } %>

      <!-- âœ… ã“ã“ã‹ã‚‰ã‚³ãƒ¡ãƒ³ãƒˆæ©Ÿèƒ½ã®è¡¨ç¤ºã‚’è¿½åŠ  ğŸ‘‡ -->
      <div class="mt-5">
        <h2 class="h4 mb-3">
          <i class="fas fa-comments text-success"></i> ã‚³ãƒ¡ãƒ³ãƒˆ
        </h2>

        <!-- ğŸ”½ ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§è¡¨ç¤º -->
        <% @comments.each do |comment| %>
          <% next if comment.user.is_deleted? %> <!-- é€€ä¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã‚¹ã‚­ãƒƒãƒ— -->
        
          <div class="card mb-2">
            <div class="card-body">
        
              <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ãƒªãƒ³ã‚¯åŒ– -->
              <p>
                <strong>
                  <% if current_user == comment.user %>
                    <%= link_to comment.user.username, user_path(current_user), class: "text-success text-decoration-none" %>
                  <% else %>
                    <%= link_to comment.user.username, user_path(comment.user), class: "text-success text-decoration-none" %>
                  <% end %>
                </strong> ã•ã‚“
              </p>
        
              <p><%= comment.content %></p>
        
              <!-- â˜… ãƒ¬ãƒ“ãƒ¥ãƒ¼è©•ä¾¡è¡¨ç¤º â˜… -->
              <p id="commentraty-<%= comment.id %>"></p>
              <script>
                document.addEventListener("DOMContentLoaded", function() {
                  raty(document.querySelector("#commentraty-<%= comment.id %>"), {
                    starOn: "<%= asset_path('star-on.png') %>",
                    starOff: "<%= asset_path('star-off.png') %>",
                    starHalf: "<%= asset_path('star-half.png') %>",
                    score: "<%= comment.rating %>",
                    readOnly: true
                  });
                });
              </script>
        
              <p class="text-muted"><%= l(comment.created_at, format: :short) %></p>
        
              <!-- è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿å‰Šé™¤å¯èƒ½ -->
              <% if comment.user == current_user %>
                <%= link_to dinner_comment_path(@dinner, comment), method: :delete, data: { confirm: 'ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ' }, class: "btn btn-sm btn-outline-danger" do %>
                  <i class="fas fa-trash"></i> å‰Šé™¤
                <% end %>
              <% end %>
        
            </div>
          </div>
        <% end %>

        <!-- ğŸ”½ ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="card mt-4">
          <div class="card-body">
            <%= form_with(model: [@dinner, @comment], local: true) do |f| %>
              <div class="form-group">
                <%= f.label :content, "ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹" %>
                <%= f.text_area :content, rows: 3, class: "form-control" %>
              </div>
              <div id="post_raty"></div>
              <div class="text-right mt-2">
                <%= f.submit "ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿ã™ã‚‹", class: "btn btn-success" %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
      <div class="d-flex flex-wrap justify-content-between mt-4">

        <% if current_user == @dinner.user %>
          <%= link_to edit_dinner_path(@dinner), class: 'btn btn-outline-success mb-2' do %>
            <i class="fas fa-edit"></i> æŠ•ç¨¿å†…å®¹ã‚’ç·¨é›†ã™ã‚‹
          <% end %>

          <%= link_to dinner_path(@dinner), method: :delete, data: { confirm: 'æœ¬å½“ã«å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ' }, class: 'btn btn-outline-danger mb-2' do %>
            <i class="fas fa-trash-alt"></i> æŠ•ç¨¿ã‚’å‰Šé™¤ã™ã‚‹
          <% end %>
        <% end %>

        <%= link_to dinners_path, class: 'btn btn-secondary mb-2' do %>
          <i class="fas fa-list"></i> æŠ•ç¨¿ä¸€è¦§ã«æˆ»ã‚‹
        <% end %>

      </div>

    </div>
  </div>
</div>
<script>
       let elem = document.querySelector('#post_raty');
         // scriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã®idã®éƒ¨åˆ†ã«é…ç½®ã™ã‚‹ã‹ã‚’æŒ‡å®š
       let opt = {  
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        scoreName: 'comment[rating]',
        };
      raty(elem,opt);
</script>